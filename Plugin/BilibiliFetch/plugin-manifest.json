{
  "manifestVersion": "1.0.0",
  "name": "BilibiliFetch",
  "displayName": "Bilibili 内容获取插件",
  "version": "2.1.0",
  "description": "Bilibili 视频内容获取插件。支持视频信息抓取（字幕/弹幕/评论/高能进度条/快照截图/HD高清抽帧）、关键词搜索（视频/UP主）、UP主投稿列表获取。支持长链接、b23.tv短链接和多P分P视频。",
  "author": "Bocchi777",
  "pluginType": "synchronous",
  "entryPoint": {
    "type": "python",
    "command": "python BilibiliFetch.py"
  },
  "communication": {
    "protocol": "stdio",
    "timeout": 60000
  },
  "configSchema": {
    "BILIBILI_COOKIE": "string"
  },
  "capabilities": {
    "invocationCommands": [
      {
        "commandIdentifier": "BilibiliFetch",
        "description": "获取 Bilibili 视频的详细信息，包括字幕、弹幕、评论、高能进度条和视频快照截图。支持多P分P视频（URL含?p=N自动识别）、b23.tv短链接自动解析、HD高清截图（基于ffmpeg从视频流直接抽帧，失败自动降级到雪碧图裁切）。\n\n参数:\n- url (字符串, 必需): Bilibili 视频的 URL。支持完整链接、BV号直接输入、b23.tv短链接。多P视频URL中的?p=N参数会被自动识别并获取对应分P内容。\n- lang (字符串, 可选): 字幕语言代码，例如 'ai-zh'（AI中文）、'ai-en'（AI英文）、'zh-CN'。未指定时按优先级自动选择：ai-zh > zh-CN > zh-Hans > 第一个可用语言。\n- danmaku_num (数字, 可选, 默认0): 获取热门弹幕的数量。\n- comment_num (数字, 可选, 默认0): 获取热门评论的数量（按点赞排序）。\n- snapshots (字符串, 可选): 截取快照的时间点（秒），多个用逗号分隔，例如 '10,60,120'。不提供则仅返回可用快照数量信息。\n- hd_snapshot (布尔值, 可选, 默认false): 是否启用HD高清截图模式。true时通过ffmpeg从视频流直接抽帧，失败自动降级到雪碧图裁切。\n- need_subs (布尔值, 可选, 默认true): 是否获取字幕内容。字幕来源优先级：CC字幕 > WBI Player API > AI Summary API。\n- need_pbp (布尔值, 可选, 默认true): 是否获取高能进度条数据（弹幕密度最高的时间点及热度值）。\n\n调用格式:\n<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\nurl:「始」视频URL「末」,\ndanmaku_num:「始」5「末」,\nsnapshots:「始」30,120「末」,\nhd_snapshot:「始」true「末」,\nneed_pbp:「始」true「末」\n<<<[END_TOOL_REQUEST]>>>\n\n重要提示：\n1. 插件返回多模态结构化数据，包含文本和 HTML <img> 标签。\n2. 请务必将返回结果中的 <img> 标签原样展示给用户以便渲染快照。\n3. HD高清截图需要ffmpeg环境，插件会自动按优先级查找：项目内置 > 系统PATH > Docker容器内。",
        "example": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\nurl:「始」https://www.bilibili.com/video/BV1CC4y1a7ee?p=2「末」,\ndanmaku_num:「始」5「末」,\nsnapshots:「始」30,120「末」,\nhd_snapshot:「始」true「末」\n<<<[END_TOOL_REQUEST]>>>"
      },
      {
        "commandIdentifier": "BilibiliSearch",
        "description": "关键词搜索 Bilibili 视频或 UP 主。基于WBI签名认证，返回结构化搜索结果，支持分页。\n\n参数:\n- action (字符串, 必需): 固定为 'search'。\n- keyword (字符串, 必需): 搜索关键词。\n- search_type (字符串, 可选, 默认'video'): 搜索类型，'video'搜索视频（返回标题/UP主/BV号/播放量/发布日期），'bili_user'搜索用户（返回昵称/MID/粉丝数/投稿数/最近投稿）。\n- page (数字, 可选, 默认1): 搜索结果页码。\n\n调用格式:\n<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\naction:「始」search「末」,\nkeyword:「始」搜索关键词「末」,\nsearch_type:「始」video「末」,\npage:「始」1「末」\n<<<[END_TOOL_REQUEST]>>>",
        "example": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\naction:「始」search「末」,\nkeyword:「始」Python教程「末」,\nsearch_type:「始」video「末」\n<<<[END_TOOL_REQUEST]>>>"
      },
      {
        "commandIdentifier": "GetUpVideos",
        "description": "获取指定 UP 主（通过 mid）的所有投稿视频列表（按发布时间倒序）。常用于在搜索到用户后，进一步获取其视频列表。B站短链接格式为 https://b23.tv/BV号，长链接格式为 https://www.bilibili.com/video/BV号。\n\n参数:\n- action (字符串, 必需): 固定为 'get_up_videos'。\n- mid (字符串, 必需): 目标 UP 主的用户 ID (MID)。\n- pn (数字, 可选, 默认1): 页码。\n- ps (数字, 可选, 默认30): 每页返回数量，最大50。\n\n调用格式:\n<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\naction:「始」get_up_videos「末」,\nmid:「始」用户MID「末」,\npn:「始」1「末」,\nps:「始」30「末」\n<<<[END_TOOL_REQUEST]>>>",
        "example": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」BilibiliFetch「末」,\naction:「始」get_up_videos「末」,\nmid:「始」927587「末」\n<<<[END_TOOL_REQUEST]>>>"
      }
    ]
  }
}
