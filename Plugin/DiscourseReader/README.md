# DiscourseReader

é€šç”¨ Discourse è®ºå›é˜…è¯»å™¨æ’ä»¶ï¼Œè®© AI Agent é«˜æ•ˆæµè§ˆ Discourse è®ºå›ï¼ˆå¦‚ [linux.do](https://linux.do)ï¼‰ã€‚é€šè¿‡ Discourse JSON API ç›´æ¥è·å–ç»“æ„åŒ–æ•°æ®ï¼Œæ— éœ€æµè§ˆå™¨è‡ªåŠ¨åŒ–æ“ä½œã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **æµè§ˆå¸–å­åˆ—è¡¨** â€” æŒ‰æ¿å—(Category)æˆ–æ ‡ç­¾(Tag)ç­›é€‰ï¼Œæ”¯æŒåˆ†é¡µå’Œæ’åº
- **é˜…è¯»å¸–å­è¯¦æƒ…** â€” è·å–å¸–å­æ­£æ–‡å’Œå›å¤ï¼ŒHTML è‡ªåŠ¨è½¬ Markdownï¼Œæ”¯æŒåˆ†é¡µæ¥¼å±‚åŠ è½½
- **æœç´¢å¸–å­** â€” å…³é”®è¯æœç´¢ï¼Œæ”¯æŒæ¿å—é™å®šå’Œæ’åºæ–¹å¼
- **Cloudflare ç©¿é€** â€” é€šè¿‡ VCP å†…ç½®çš„ UrlFetch æ’ä»¶ï¼ˆPuppeteer + Stealthï¼‰è‡ªåŠ¨ç»•è¿‡ Cloudflare é˜²æŠ¤
- **é›¶é…ç½®è®¤è¯** â€” è‡ªåŠ¨è¯»å– VCP ä¸»é…ç½®çš„ Cookie å’Œ API Keyï¼Œæ— éœ€é‡å¤é…ç½®

## ğŸ“¦ ä¾èµ–

- **VCP** ä¸»ç¨‹åº
- **UrlFetch** æ’ä»¶ï¼ˆVCP å†…ç½®ï¼Œç”¨äºç»•è¿‡ Cloudflareï¼‰

æ— éœ€å®‰è£…é¢å¤–çš„ npm åŒ…ï¼Œæ’ä»¶ä½¿ç”¨ Node.js åŸç”Ÿæ¨¡å—ã€‚

## ğŸ”‘ å‰ç½®é…ç½®ï¼šCookie

DiscourseReader é€šè¿‡ VCP å†…ç½®çš„ UrlFetch æ’ä»¶è®¿é—®è®ºå›ï¼ŒCookie éœ€è¦é…ç½®åœ¨ **VCP ä¸»ç›®å½•çš„ `config.env`** ä¸­ï¼ˆä¸æ˜¯æ’ä»¶è‡ªå·±çš„ config.envï¼‰ï¼š

```env
# VCP æ ¹ç›®å½•çš„ config.env
FETCH_COOKIES_RAW="ä½ çš„è®ºå›å®Œæ•´ Cookie å­—ç¬¦ä¸²"
```

**è·å– Cookie çš„æ–¹æ³•ï¼š**

1. ç”¨æµè§ˆå™¨ç™»å½•ç›®æ ‡ Discourse è®ºå›ï¼ˆå¦‚ linux.doï¼‰
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ åˆ‡æ¢åˆ°ã€Œç½‘ç»œã€æ ‡ç­¾
3. åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»ä»»æ„ä¸€ä¸ªè¯·æ±‚
4. åœ¨ã€Œè¯·æ±‚æ ‡å¤´ã€ä¸­æ‰¾åˆ° `Cookie` å­—æ®µï¼Œå¤åˆ¶å®Œæ•´å†…å®¹
5. ç²˜è´´åˆ° VCP ä¸» `config.env` çš„ `FETCH_COOKIES_RAW` å­—æ®µä¸­

> **æ³¨æ„**ï¼šCookie åŒ…å« `cf_clearance` ç­‰ Cloudflare éªŒè¯ä¿¡æ¯ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°è·å–ã€‚

## âš™ï¸ é…ç½®

ç¼–è¾‘æ’ä»¶ç›®å½•ä¸‹çš„ `config.env`ï¼š

```env
# è®ºå›åŸºç¡€ URLï¼ˆä¸å¸¦å°¾éƒ¨æ–œæ ï¼‰
DISCOURSE_BASE_URL=https://linux.do

# é»˜è®¤æ¿å— slugï¼ˆä»…åœ¨ä¸ä¼  tag å‚æ•°æ—¶ç”Ÿæ•ˆï¼‰
DEFAULT_CATEGORY=develop

# å¸–å­æ­£æ–‡æœ€å¤§å­—ç¬¦æ•°ï¼ˆé˜²æ­¢è¶…é•¿å¸–å­å ç”¨è¿‡å¤š tokenï¼‰
MAX_CONTENT_LENGTH=3000

# è¯»å–å¸–å­æ—¶é»˜è®¤çš„æœ€å¤§å›å¤æ•°
MAX_POSTS=10
```

**Cookie å’Œ API Key è¯´æ˜**ï¼šæ’ä»¶ä¼šè‡ªåŠ¨ä» VCP ä¸» `config.env` è¯»å– `Key` å­—æ®µï¼ˆæœåŠ¡å¯†ç ï¼‰å’Œ UrlFetch çš„ Cookie é…ç½®ï¼Œé€šå¸¸æ— éœ€åœ¨æ’ä»¶å†…å•ç‹¬é…ç½®ã€‚

## ğŸš€ å‘½ä»¤

### ListTopics â€” æµè§ˆå¸–å­åˆ—è¡¨

æŒ‰æ¿å—æˆ–æ ‡ç­¾æµè§ˆè®ºå›å¸–å­ï¼Œè¿”å›æ ‡é¢˜ã€ä½œè€…ã€å›å¤æ•°ã€æµè§ˆæ•°ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| command | string | æ˜¯ | å›ºå®šä¸º `ListTopics` |
| category | string | å¦ | æ¿å— slugï¼Œå¦‚ `develop`ã€`welfare`ã€‚ä¸ä¼ åˆ™ä½¿ç”¨é»˜è®¤æ¿å— |
| tag | string | å¦ | æ ‡ç­¾è·¯å¾„ï¼Œå¦‚ `444-tag/444`ï¼ˆäººå·¥æ™ºèƒ½ï¼‰ã€‚ä¼ å…¥æ—¶ category é»˜è®¤å¤±æ•ˆ |
| page | number | å¦ | é¡µç ï¼Œé»˜è®¤ 0ï¼ˆç¬¬ä¸€é¡µï¼‰ï¼Œæ¯é¡µ 30 æ¡ |
| order | string | å¦ | æ’åºï¼š`latest`(é»˜è®¤) / `views` / `posts` |

### ReadTopic â€” é˜…è¯»å¸–å­è¯¦æƒ…

è·å–å¸–å­çš„å®Œæ•´æ­£æ–‡å’Œå›å¤å†…å®¹ï¼ŒHTML è‡ªåŠ¨è½¬æ¢ä¸º Markdownã€‚

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| command | string | æ˜¯ | å›ºå®šä¸º `ReadTopic` |
| topic_id | number | äºŒé€‰ä¸€ | å¸–å­ ID |
| url | string | äºŒé€‰ä¸€ | å¸–å­å®Œæ•´ URLï¼Œè‡ªåŠ¨æå– ID |
| max_posts | number | å¦ | æœ€å¤§å›å¤æ•°ï¼Œé»˜è®¤ä½¿ç”¨é…ç½®å€¼ã€‚å•æ¬¡ç¨³å®šä¸Šé™çº¦ 50 æ¥¼ |
| post_number | number | å¦ | ä»ç¬¬å‡ æ¥¼å¼€å§‹è¯»å–ï¼Œé»˜è®¤ 1ã€‚ç”¨äºåˆ†æ‰¹è¯»å–é•¿å¸– |

### ListCategories â€” è·å–æ¿å—åˆ—è¡¨

è·å–è®ºå›æ‰€æœ‰æ¿å—çš„åç§°ã€slug å’Œå¸–å­æ•°é‡ã€‚

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| command | string | æ˜¯ | å›ºå®šä¸º `ListCategories` |

**è¿”å›ç¤ºä¾‹ï¼š**
```
| # | Category | Slug | Topics | Posts |
|---|----------|------|--------|-------|
| 1 | å¼€å‘è°ƒä¼˜ | develop | 67910 | 580000 |
| 2 | ç¦åˆ©ç¾Šæ¯› | welfare | 11930 | 120000 |
```

> Slug åˆ—çš„å€¼å¯ä»¥ç›´æ¥ç”¨äº ListTopics çš„ `category` å‚æ•°ã€‚

### ListTags â€” è·å–æ ‡ç­¾åˆ—è¡¨

è·å–è®ºå›æ‰€æœ‰æ ‡ç­¾çš„åç§°ã€è·¯å¾„å’Œå¸–å­æ•°é‡ï¼ŒæŒ‰å¸–å­æ•°é™åºæ’åˆ—ã€‚

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| command | string | æ˜¯ | å›ºå®šä¸º `ListTags` |

**è¿”å›ç¤ºä¾‹ï¼š**
```
| # | Tag | Path | Posts |
|---|-----|------|-------|
| 1 | äººå·¥æ™ºèƒ½ | 444-tag/444 | 59791 |
| 2 | ChatGPT | chatgpt | 8552 |
```

> Path åˆ—çš„å€¼å¯ä»¥ç›´æ¥ç”¨äº ListTopics çš„ `tag` å‚æ•°ã€‚

### SearchForum â€” æœç´¢å¸–å­

åœ¨è®ºå›ä¸­æœç´¢å¸–å­ï¼Œè¿”å›åŒ¹é…çš„è¯é¢˜åˆ—è¡¨å’Œå†…å®¹ç‰‡æ®µã€‚

**å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| command | string | æ˜¯ | å›ºå®šä¸º `SearchForum` |
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ |
| category | string | å¦ | é™å®šæ¿å— slug |
| order | string | å¦ | æ’åºï¼š`relevance`(é»˜è®¤) / `latest` / `likes` / `views` |
| page | number | å¦ | é¡µç ï¼Œé»˜è®¤ 1 |

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

**æµè§ˆå¼€å‘æ¿å—ï¼š**
```
category: develop
```

**æŒ‰æ ‡ç­¾ç­›é€‰ï¼ˆäººå·¥æ™ºèƒ½ï¼‰ï¼š**
```
tag: 444-tag/444
```

**ç¿»åˆ°ç¬¬äºŒé¡µï¼š**
```
tag: 444-tag/444
page: 1
```

**é˜…è¯»å¸–å­è¯¦æƒ…ï¼š**
```
topic_id: 1638705
max_posts: 20
```

**åˆ†æ‰¹è¯»å–é•¿å¸–ï¼ˆ50 æ¥¼ä¹‹åï¼‰ï¼š**
```
topic_id: 1638705
max_posts: 50
post_number: 51
```

## ğŸ—ï¸ æ¶æ„

```
Agent è°ƒç”¨ DiscourseReader
  â†’ DiscourseReader æ„é€  Discourse JSON API URL
    â†’ HTTP POST åˆ° VCP /v1/human/tool ç«¯ç‚¹
      â†’ VCP è°ƒç”¨ UrlFetchï¼ˆPuppeteer + Stealth + Cookieï¼‰
        â†’ ç»•è¿‡ Cloudflare
          â†’ è·å– Discourse JSON æ•°æ®
  â†’ extractJSON() ä» UrlFetch å“åº”ä¸­æå– JSON
  â†’ æ ¼å¼åŒ–ä¸º Markdown è¡¨æ ¼è¿”å›ç»™ Agent
```

**ä¸ºä»€ä¹ˆä¸ç›´æ¥ HTTP è¯·æ±‚ï¼Ÿ**

Discourse è®ºå›ï¼ˆå¦‚ linux.doï¼‰å— Cloudflare ä¿æŠ¤ï¼ŒNode.js åŸç”Ÿ `https` æ¨¡å—å’Œ `curl` çš„ TLS æŒ‡çº¹ä¼šè¢« Cloudflare è¯†åˆ«å¹¶æ‹¦æˆªã€‚é€šè¿‡å¤ç”¨ VCP å†…ç½®çš„ UrlFetch æ’ä»¶ï¼ˆåŸºäº Puppeteer + puppeteer-extra-plugin-stealthï¼‰ï¼Œå¯ä»¥æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨æŒ‡çº¹ç»•è¿‡é˜²æŠ¤ã€‚

## âš ï¸ å·²çŸ¥é™åˆ¶

1. **å•æ¬¡è¯»å–ä¸Šé™çº¦ 50 æ¥¼** â€” è¶…è¿‡ 50 æ¥¼çš„å¸–å­éœ€è¦ä½¿ç”¨ `post_number` å‚æ•°åˆ†æ‰¹è¯»å–
2. **æœç´¢å—é¢‘ç‡é™åˆ¶** â€” Discourse æœç´¢ API æœ‰é¢‘ç‡é™åˆ¶ï¼Œé¢‘ç¹æœç´¢ä¼šè¿”å› 429 é”™è¯¯
3. **ä¾èµ– UrlFetch** â€” æœ¬æ’ä»¶ä¸ç‹¬ç«‹å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œä¾èµ– VCP çš„ UrlFetch æ’ä»¶

## ğŸ“ linux.do å¸¸ç”¨æ¿å—ä¸æ ‡ç­¾

**æ¿å— (Category slug)ï¼š**

| æ¿å— | slug |
|------|------|
| å¼€å‘è°ƒä¼˜ | `develop` |
| èµ„æºèŸèƒ | `resource` |
| å‰æ²¿å¿«è®¯ | `news` |
| ç¦åˆ©ç¾Šæ¯› | `welfare` |
| æä¸ƒæ»ä¸‰ | `gossip` |

**çƒ­é—¨æ ‡ç­¾ (Tag è·¯å¾„)ï¼š**

| æ ‡ç­¾ | è·¯å¾„ |
|------|------|
| äººå·¥æ™ºèƒ½ | `444-tag/444` |
| ChatGPT | `chatgpt` |
| OpenAI | `openai` |
| Cursor | `cursor` |
| VPS | `vps` |

## ğŸ“„ License

MIT