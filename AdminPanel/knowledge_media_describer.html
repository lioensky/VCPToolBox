<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>知识库多媒体描述管理</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root {
      --kms-radius: 12px;
    }

    body {
      margin: 0;
      padding: 18px;
      background: var(--background-color);
      color: var(--text-color-primary);
      font-family: inherit;
    }

    .kms-page {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .kms-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 12px;
      flex-wrap: wrap;
    }

    .kms-title-wrap h2 {
      margin: 0;
      font-size: 1.25rem;
      color: var(--text-color-primary);
    }

    .kms-title-wrap p {
      margin: 6px 0 0 0;
      color: var(--text-color-secondary);
      font-size: 0.9rem;
    }

    .kms-stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .kms-stat-chip {
      border: 1px solid var(--border-color);
      border-radius: 999px;
      padding: 6px 10px;
      background: var(--background-color-light);
      color: var(--text-color-primary);
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .kms-toolbar {
      display: grid;
      grid-template-columns: 2fr repeat(4, minmax(120px, 1fr)) auto auto;
      gap: 8px;
      border: 1px solid var(--border-color);
      border-radius: var(--kms-radius);
      padding: 10px;
      background: var(--background-color-light);
    }

    .kms-toolbar input[type="text"],
    .kms-toolbar select {
      width: 100%;
      box-sizing: border-box;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--background-color);
      color: var(--text-color-primary);
      padding: 8px 10px;
      min-height: 36px;
    }

    .kms-btn {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--background-color);
      color: var(--text-color-primary);
      padding: 8px 12px;
      min-height: 36px;
      cursor: pointer;
      white-space: nowrap;
    }

    .kms-btn:hover {
      background: var(--primary-color-translucent);
    }

    .kms-btn.primary {
      background: var(--primary-color-translucent);
    }

    .kms-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .status-message {
      min-height: 20px;
      font-size: 0.9rem;
    }

    .status-message.success { color: #2ecc71; }
    .status-message.error { color: #e74c3c; }
    .status-message.info { color: #7aa1ff; }

    .kms-list-wrap {
      border: 1px solid var(--border-color);
      border-radius: var(--kms-radius);
      background: var(--background-color-light);
      overflow: hidden;
    }

    .kms-list-header {
      display: grid;
      grid-template-columns: 1fr 112px 148px 116px;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color-secondary);
      font-size: 0.85rem;
      background: var(--background-color);
    }

    .kms-list {
      display: flex;
      flex-direction: column;
      max-height: 68vh;
      overflow: auto;
    }

    .kms-empty {
      text-align: center;
      color: var(--text-color-secondary);
      padding: 28px 8px;
      font-size: 0.95rem;
    }

    .kms-item {
      display: grid;
      grid-template-columns: 1fr 112px 148px 116px;
      gap: 10px;
      align-items: stretch;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .kms-item:last-child {
      border-bottom: none;
    }

    .kms-main {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 0;
    }

    .kms-main-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .kms-path {
      font-weight: 600;
      color: var(--text-color-primary);
      word-break: break-all;
    }

    .kms-badges {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      border: 1px solid var(--border-color);
      background: var(--background-color);
      color: var(--text-color-secondary);
    }

    .badge.ok {
      color: #2ecc71;
      border-color: rgba(46, 204, 113, 0.4);
    }

    .badge.warn {
      color: #f39c12;
      border-color: rgba(243, 156, 18, 0.4);
    }

    .kms-input,
    .kms-textarea {
      width: 100%;
      box-sizing: border-box;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--background-color);
      color: var(--text-color-primary);
      padding: 8px 10px;
      min-height: 34px;
    }

    .kms-textarea {
      min-height: 72px;
      resize: vertical;
    }

    .kms-inline-grid {
      display: grid;
      grid-template-columns: minmax(180px, 1fr) minmax(200px, 1fr);
      gap: 8px;
    }

    .kms-right,
    .kms-size,
    .kms-actions {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 8px;
    }

    .kms-size {
      color: var(--text-color-secondary);
      font-size: 0.85rem;
    }

    .kms-actions .kms-btn {
      width: 100%;
      padding: 7px 8px;
      font-size: 0.85rem;
    }

    .kms-actions .kms-btn.regen {
      border-color: rgba(122, 161, 255, 0.5);
      color: #7aa1ff;
    }

    @media (max-width: 1260px) {
      .kms-toolbar {
        grid-template-columns: 1fr 1fr 1fr;
      }
      .kms-list-header {
        display: none;
      }
      .kms-item {
        grid-template-columns: 1fr;
      }
      .kms-right, .kms-size, .kms-actions {
        flex-direction: row;
        align-items: center;
        flex-wrap: wrap;
      }
      .kms-actions .kms-btn {
        width: auto;
      }
    }
  </style>
  <script>
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'themeChange') {
        document.documentElement.setAttribute('data-theme', event.data.theme);
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'requestTheme' }, '*');
      }
    });
  </script>
</head>
<body>
  <div class="kms-page">
    <div class="kms-header">
      <div class="kms-title-wrap">
        <h2>知识库多媒体描述管理</h2>
        <p>按类型分类筛选、就地编辑描述与标签，支持按预设重生成。</p>
      </div>
      <div class="kms-stats">
        <span class="kms-stat-chip" id="kms-count">共 0 项</span>
        <span class="kms-stat-chip" id="kms-sidecar-count">有侧车 0 项</span>
        <span class="kms-stat-chip" id="kms-missing-count">缺侧车 0 项</span>
      </div>
    </div>

    <div class="kms-toolbar">
      <input id="kms-search-input" type="text" placeholder="搜索：路径 / 描述 / Tag / 署名">
      <select id="kms-type-filter">
        <option value="all">全部类型</option>
        <option value="image">图片</option>
        <option value="audio">音频</option>
        <option value="video">视频</option>
        <option value="document">文档</option>
        <option value="other">其他</option>
      </select>
      <select id="kms-sidecar-filter">
        <option value="all">全部侧车状态</option>
        <option value="has">仅有侧车</option>
        <option value="missing">仅缺侧车</option>
      </select>
      <select id="kms-sort-select">
        <option value="modified_desc">修改时间：新→旧</option>
        <option value="modified_asc">修改时间：旧→新</option>
        <option value="size_desc">大小：大→小</option>
        <option value="size_asc">大小：小→大</option>
        <option value="path_asc">路径：A→Z</option>
      </select>
      <button id="kms-search-btn" class="kms-btn">筛选</button>
      <button id="kms-reload-btn" class="kms-btn">刷新</button>
    </div>

    <div class="kms-meta-row">
      <div id="kms-status" class="status-message info"></div>
    </div>

    <div class="kms-list-wrap">
      <div class="kms-list-header">
        <div>文件 / 描述 / Tag / 署名</div>
        <div>预设</div>
        <div>大小 / 修改时间</div>
        <div>操作</div>
      </div>
      <div id="kms-list" class="kms-list">
        <div class="kms-empty">加载中...</div>
      </div>
    </div>
  </div>

  <script src="js/knowledge-media-describer.js"></script>
</body>
</html>